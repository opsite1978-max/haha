<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°æŒ‡æ±ºç­–æ ¸å¿ƒ V17.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* APP é¢¨æ ¼è¨­å®š */
        :root { --bg: #0f172a; --card: #1e293b; --input-bg: #334155; --text: #f1f5f9; --red: #ef4444; --green: #10b981; --gold: #f59e0b; --blue: #3b82f6; --purple: #a855f7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 100px; -webkit-font-smoothing: antialiased; }
        .app-container { max-width: 600px; margin: 0 auto; background: var(--card); min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* é ‚éƒ¨å°èˆª */
        .header { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #334155; }
        h1 { margin: 0; font-size: 18px; font-weight: 800; letter-spacing: 0.5px; background: linear-gradient(90deg, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 10px; color: #64748b; margin-top: 2px; }

        /* æ•¸æ“šå‚³é€é–€ (æ©«å‘æ²å‹•) */
        .portal-bar { display: flex; gap: 10px; padding: 12px 15px; background: #0b1120; overflow-x: auto; border-bottom: 1px solid #333; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .portal-bar::-webkit-scrollbar { display: none; }
        .portal-btn { flex: 0 0 auto; padding: 8px 14px; border-radius: 20px; font-size: 12px; text-decoration: none; color: #cbd5e1; border: 1px solid #475569; transition: 0.2s; display: flex; align-items: center; gap: 6px; background: #1e293b; font-weight: 500; }
        .portal-btn:active { transform: scale(0.95); background: #334155; border-color: var(--blue); color: #fff; }

        /* åœ–è¡¨å€ */
        .chart-wrapper { padding: 15px; background: #0b1120; border-bottom: 1px solid #333; }
        .chart-container { position: relative; height: 200px; width: 100%; }

        /* æ“ä½œæŒ‰éˆ•ç¾¤ */
        .btn-group { padding: 15px; display: grid; grid-template-columns: 2fr 1fr 0.5fr; gap: 10px; }
        .btn { padding: 14px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-auto { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-record { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-clear { background: #475569; }

        /* è¼¸å…¥å€å¡Š */
        .section { padding: 0 20px 15px 20px; animation: fadeIn 0.5s ease; }
        .section-title { font-size: 13px; color: #94a3b8; font-weight: 700; margin-bottom: 10px; border-left: 4px solid var(--blue); padding-left: 8px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        .row { display: flex; gap: 10px; margin-bottom: 12px; }
        .col { flex: 1; }
        label { display: block; font-size: 11px; color: #94a3b8; margin-bottom: 5px; font-weight: 500; }
        input { width: 100%; background: var(--input-bg); border: 1px solid #475569; color: white; padding: 12px; border-radius: 8px; font-size: 18px; font-weight: 700; text-align: center; outline: none; box-sizing: border-box; transition: 0.2s; }
        input:focus { border-color: var(--blue); background: #1e293b; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }

        /* ç‰¹æ®Šè¼¸å…¥æ¡† */
        .hl-input input { border-color: var(--gold); background: #422006; color: #fbbf24; font-size: 22px; } 
        .op-input input { border-color: #8b5cf6; background: #2e1065; color: #d8b4fe; } 
        .total-input input { border-color: #ec4899; background: #500724; color: #fbcfe8; font-size: 20px; }
        
        /* é¸æ“‡æ¬Šæˆ°å ´é›·é” */
        .op-radar-box { margin: 10px 0; padding: 15px; background: #111827; border: 1px solid #374151; border-radius: 12px; position: relative; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }
        .op-bar-container { height: 16px; background: #334155; border-radius: 8px; position: relative; margin: 25px 0; overflow: hidden; }
        .op-marker { position: absolute; top: -4px; bottom: -4px; width: 6px; background: #fff; border-radius: 3px; box-shadow: 0 0 10px #fff; z-index: 10; transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .zone-pressure { position: absolute; right: 0; top: 0; bottom: 0; width: 40%; background: linear-gradient(to left, rgba(239,68,68,0.6), transparent); }
        .zone-support { position: absolute; left: 0; top: 0; bottom: 0; width: 40%; background: linear-gradient(to right, rgba(16,185,129,0.6), transparent); }
        .op-space { display: flex; justify-content: space-between; font-size: 11px; font-family: monospace; }

        /* é—œéµé»ä½ */
        .key-levels-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; background: #0f172a; padding: 10px; border-radius: 10px; border: 1px solid #334155; }
        .level-item { text-align: center; padding: 8px 4px; background: #1e293b; border-radius: 6px; }
        .level-title { font-size: 10px; color: #64748b; margin-bottom: 2px; }
        .level-val { font-size: 14px; font-weight: 800; color: #fff; }
        .level-up { color: #ef4444; } .level-mid { color: #f59e0b; } .level-down { color: #10b981; }

        /* åˆ¤æ–·çµæœå€ */
        .verdict-box { background: rgba(15, 23, 42, 0.95); padding: 20px; text-align: center; border-top: 1px solid #333; position: sticky; bottom: 0; backdrop-filter: blur(10px); z-index: 90; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); border-radius: 20px 20px 0 0; }
        .verdict { font-size: 26px; font-weight: 900; margin-bottom: 5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .desc { font-size: 13px; color: #94a3b8; margin-bottom: 10px; }
        .target-box { display: flex; justify-content: space-between; background: #1e293b; padding: 10px 20px; border-radius: 10px; margin-top: 10px; }

        #loading { display: none; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* éš±è—å…ƒç´  */
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>å°æŒ‡æ±ºç­–æ ¸å¿ƒ V17.0</h1>
        <div class="subtitle">æˆ°å ´åœ°åœ– â€¢ åƒ¹å·®ç›£æ§ â€¢ æ™ºèƒ½åˆ†æ</div>
    </div>

    <div class="portal-bar">
        <a href="https://www.wantgoo.com/option/support-resistance" target="_blank" class="portal-btn">ğŸ›¡ï¸ ç©è‚¡OPå¤§é‡å€</a>
        <a href="https://www.wantgoo.com/futures/institutional-investors/net-open-interest" target="_blank" class="portal-btn">ğŸ¦ ç©è‚¡ä¸»åŠ›</a>
        <a href="https://www.wantgoo.com/option/put-call-ratio" target="_blank" class="portal-btn">ğŸ“Š P/C Ratio</a>
        <a href="https://www.wantgoo.com/futures/retail-indicator/wmt&" target="_blank" class="portal-btn">ğŸœ æ•£æˆ¶æŒ‡æ¨™</a>
    </div>

    <div class="chart-wrapper">
        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-auto" onclick="autoFetch()">
            âš¡ æŠ“å–æ˜¨æ”¶/æ³¢å‹• <span id="loading">â†»</span>
        </button>
        <button class="btn btn-record" onclick="recordData()">ğŸ’¾ è¨˜éŒ„</button>
        <button class="btn btn-clear" onclick="clearHistory()">ğŸ—‘ï¸</button>
    </div>

    <div class="section">
        <div class="section-title">ğŸ›¡ï¸ é¸æ“‡æ¬Šæˆ°å ´ (è¼¸å…¥æœ€å¤§é‡å€)</div>
        <div class="row">
            <div class="col op-input">
                <label>åœ°æ¿ (æœ€å¤§ Put)</label>
                <input type="number" id="op_support" placeholder="ä¾‹å¦‚ 28200" oninput="calc()">
            </div>
            <div class="col op-input">
                <label>å¤©èŠ±æ¿ (æœ€å¤§ Call)</label>
                <input type="number" id="op_pressure" placeholder="ä¾‹å¦‚ 29000" oninput="calc()">
            </div>
        </div>
        
        <div class="op-radar-box">
            <div class="op-space">
                <span id="space-down" style="color:#10b981;">ç­‰å¾…æ•¸æ“š</span>
                <span id="space-up" style="color:#ef4444;">ç­‰å¾…æ•¸æ“š</span>
            </div>
            <div class="op-bar-container">
                <div class="zone-support"></div>
                <div class="zone-pressure"></div>
                <div id="price-marker" class="op-marker" style="left: 50%;"></div>
            </div>
            <div style="display:flex; justify-content:space-between; color:#666; font-size:10px;">
                <span>æ”¯æ’å€</span>
                <span id="radar-tx" style="color:#fff; font-weight:bold;">--</span>
                <span>å£“åŠ›å€</span>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">
            <span>1. åƒ¹æ ¼ç›£æ§</span>
            <span id="spread-tag" style="font-size:11px; padding:2px 6px; border-radius:4px; background:#333;">--</span>
        </div>
        <div class="row">
            <div class="col hl-input">
                <label>ğŸ“ å°æŒ‡æœŸ (å¿…å¡«)</label>
                <input type="number" id="tx" placeholder="è¼¸å…¥ç›®å‰é»æ•¸" oninput="calc()">
            </div>
            <div class="col">
                <label>âš–ï¸ åŠ æ¬ŠæŒ‡æ•¸ (è‡ªå‹•)</label>
                <input type="number" id="spot" disabled placeholder="è‡ªå‹•æŠ“å–" oninput="calc()">
            </div>
        </div>
        <div class="row">
            <div class="col">
                <label>ğŸ›¡ï¸ P/C Ratio (%)</label>
                <input type="number" id="pc" placeholder="æ‰‹å‹•è¼¸å…¥" oninput="calc()">
            </div>
            <div class="col">
                <label>ATR æ³¢å‹•</label>
                <input type="number" id="atr" oninput="calc()">
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">2. ä¸»åŠ›ç±Œç¢¼</div>
        <div class="row">
            <div class="col total-input">
                <label>ğŸ¦ æ³•äººç¸½å’Œ (è‡ª+æŠ•+å¤–)</label>
                <input type="number" id="total_sum" placeholder="çœ‹ç©è‚¡ç¶²å¡«å…¥" oninput="calc()">
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">3. æ•£æˆ¶ (è¼¸å…¥å£æ•¸)</div>
        <div style="background:#1e293b; padding:10px; border-radius:8px; border:1px solid #334155;">
            <div style="font-size:11px; color:#aaa; margin-bottom:5px; text-align:center;">å°å° MTX</div>
            <div class="row" style="margin-bottom:0;">
                <div class="col">
                    <input type="number" id="mtx_long" placeholder="å¤šå–®" style="color:#fca5a5; border-color:#7f1d1d;" oninput="calc()">
                </div>
                <div class="col">
                    <input type="number" id="mtx_short" placeholder="ç©ºå–®" style="color:#86efac; border-color:#064e3b;" oninput="calc()">
                </div>
            </div>
        </div>
        <div style="height:8px;"></div>
        <div style="background:#1e293b; padding:10px; border-radius:8px; border:1px solid #334155;">
            <div style="font-size:11px; color:#aaa; margin-bottom:5px; text-align:center;">å¾®å° TMF</div>
            <div class="row" style="margin-bottom:0;">
                <div class="col">
                    <input type="number" id="tmf_long" placeholder="å¤šå–®" style="color:#fca5a5; border-color:#7f1d1d;" oninput="calc()">
                </div>
                <div class="col">
                    <input type="number" id="tmf_short" placeholder="ç©ºå–®" style="color:#86efac; border-color:#064e3b;" oninput="calc()">
                </div>
            </div>
        </div>
    </div>

    <div class="section" style="margin-bottom:20px;">
        <div class="section-title">ğŸ”‘ åƒè€ƒé»ä½ (æ˜¨æ”¶è¨ˆç®—)</div>
        <div class="key-levels-box">
            <div class="level-item"><div class="level-title">ä¸Šé—œ</div><div id="kp_high" class="level-val level-up">--</div></div>
            <div class="level-item"><div class="level-title">ä¸­é—œ</div><div id="kp_mid" class="level-val level-mid">--</div></div>
            <div class="level-item"><div class="level-title">ä¸‹é—œ</div><div id="kp_low" class="level-val level-down">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜å£“</div><div id="pivot_res" class="level-val level-up">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜åƒ¹</div><div id="pivot_p" class="level-val level-mid">--</div></div>
            <div class="level-item"><div class="level-title">è½‰æŠ˜æ’</div><div id="pivot_sup" class="level-val level-down">--</div></div>
        </div>
        <div class="hidden"><input id="prev_high"><input id="prev_low"><input id="prev_close"></div>
    </div>

    <div class="verdict-box">
        <div id="verdict" class="verdict" style="color:#64748b">ç­‰å¾…æ•¸æ“š</div>
        <div id="desc" class="desc">å¡«å¯«å¾Œè‡ªå‹•åˆ†æå¤šç©ºæˆ°ç•¥</div>
        
        <div class="target-box">
            <div>
                <div style="font-size:10px; color:#888;">ä¿å®ˆç›®æ¨™</div>
                <div id="tp1" style="font-size:16px; font-weight:bold; color:#ccc;">--</div>
            </div>
            <div>
                <div style="font-size:10px; color:#888;">ç©æ¥µç›®æ¨™</div>
                <div id="tp2" style="font-size:16px; font-weight:bold; color:#ccc;">--</div>
            </div>
        </div>
    </div>
</div>

<script>
    let myChart;
    const ids = ['tx', 'spot', 'atr', 'total_sum', 'pc', 'mtx_long', 'mtx_short', 'tmf_long', 'tmf_short', 'prev_high', 'prev_low', 'prev_close', 'op_support', 'op_pressure'];

    window.onload = () => {
        ids.forEach(id => {
            const v = localStorage.getItem('last_' + id);
            if(v) document.getElementById(id).value = v;
        });
        initChart();
        updateChartFromStorage();
        calc();
    };

    function initChart() {
        const ctx = document.getElementById('trendChart').getContext('2d');
        Chart.defaults.color = '#64748b';
        Chart.defaults.font.family = '-apple-system, system-ui';
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'å°æŒ‡æœŸ', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, yAxisID: 'y', borderWidth: 2, tension: 0.3, pointRadius: 0 },
                    { label: 'P/C %', data: [], borderColor: '#f59e0b', yAxisID: 'y1', borderWidth: 2, borderDash: [4, 4], tension: 0.1, pointRadius: 0 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { labels: { color: '#ccc', boxWidth: 10, font: {size: 11} } } },
                scales: {
                    x: { ticks: { color: '#666', font: {size: 10} }, grid: { display: false } },
                    y: { type: 'linear', display: true, position: 'left', ticks: { color: '#3b82f6' }, grid: { color: '#1e293b' } },
                    y1: { type: 'linear', display: true, position: 'right', ticks: { color: '#f59e0b' }, grid: { drawOnChartArea: false } }
                }
            }
        });
    }

    async function autoFetch() {
        const icon = document.getElementById('loading');
        icon.style.display = 'inline-block';
        try {
            const ts = new Date().getTime();
            const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/%5ETWII?interval=1d&range=5d&_=' + ts)}`);
            const data = await res.json();
            const result = JSON.parse(data.contents).chart.result[0];
            const quotes = result.indicators.quote[0];
            const len = quotes.close.length;
            
            let idx = len - 1;
            if (len >= 2) idx = len - 2;
            const prevH = quotes.high[idx];
            const prevL = quotes.low[idx];
            const prevC = quotes.close[idx];
            const lastPrice = result.meta.regularMarketPrice;

            let sum = 0, count = 0;
            for(let i=0; i<len; i++) {
                if(quotes.high[i]) { sum += (quotes.high[i] - quotes.low[i]); count++; }
            }
            const atr = count ? Math.round(sum/count) : 250;

            document.getElementById('atr').value = atr;
            document.getElementById('spot').value = Math.round(lastPrice);
            document.getElementById('prev_high').value = prevH;
            document.getElementById('prev_low').value = prevL;
            document.getElementById('prev_close').value = prevC;

            if(!document.getElementById('tx').value) document.getElementById('tx').value = Math.round(lastPrice);
            
            calc();
        } catch(e) { alert('é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'); }
        icon.style.display = 'none';
    }

    function calc() {
        ids.forEach(id => {
            const el = document.getElementById(id);
            localStorage.setItem('last_' + id, el.value);
        });

        const tx = parseInt(document.getElementById('tx').value);
        const spot = parseInt(document.getElementById('spot').value);
        const atr = parseInt(document.getElementById('atr').value) || 250;
        const total = parseInt(document.getElementById('total_sum').value) || 0;
        const pc = parseFloat(document.getElementById('pc').value) || 100;
        
        const mtx_L = parseInt(document.getElementById('mtx_long').value) || 0;
        const mtx_S = parseInt(document.getElementById('mtx_short').value) || 0;
        const tmf_L = parseInt(document.getElementById('tmf_long').value) || 0;
        const tmf_S = parseInt(document.getElementById('tmf_short').value) || 0;
        const retail_net = (mtx_L - mtx_S) + ((tmf_L - tmf_S) * 0.2);

        // é›·é”
        const op_sup = parseInt(document.getElementById('op_support').value);
        const op_pres = parseInt(document.getElementById('op_pressure').value);
        if(op_sup && op_pres && tx) {
            const range = op_pres - op_sup;
            const pos = tx - op_sup;
            let pct = (pos / range) * 100;
            if(pct < 0) pct = 0; if(pct > 100) pct = 100;
            document.getElementById('price-marker').style.left = pct + "%";
            document.getElementById('space-up').innerText = `è·å£“åŠ› ${op_pres - tx}`;
            document.getElementById('space-down').innerText = `è·æ”¯æ’ ${tx - op_sup}`;
            document.getElementById('radar-tx').innerText = tx;
        }

        // åƒ¹å·®
        const sTag = document.getElementById('spread-tag');
        if (tx && spot) {
            let spread = tx - spot;
            if (spread > 0) {
                sTag.innerText = `æ­£åƒ¹å·® +${spread}`; sTag.style.background = "#b91c1c"; sTag.style.color = "#fff";
            } else {
                sTag.innerText = `é€†åƒ¹å·® ${spread}`; sTag.style.background = "#047857"; sTag.style.color = "#fff";
            }
        }

        // é—œéµé»ä½
        const pH = parseFloat(document.getElementById('prev_high').value);
        const pL = parseFloat(document.getElementById('prev_low').value);
        const pC = parseFloat(document.getElementById('prev_close').value);
        if (pH && pL && pC) {
            const mid = (pH + pL) / 2;
            const up = pL + (pH - pL) * 0.618;
            const down = pH - (pH - pL) * 0.618;
            document.getElementById('kp_high').innerText = Math.round(up);
            document.getElementById('kp_mid').innerText = Math.round(mid);
            document.getElementById('kp_low').innerText = Math.round(down);
            const cdp = (pH + pL + 2*pC) / 4;
            document.getElementById('pivot_p').innerText = Math.round(cdp);
            document.getElementById('pivot_res').innerText = Math.round(2*cdp - pL);
            document.getElementById('pivot_sup').innerText = Math.round(2*cdp - pH);
        }

        if(!tx) return;

        // è©•åˆ†
        let score = 0;
        if (total > 5000) score += 35; else if (total < -5000) score -= 35;
        if(pc > 110) score += 20; else if(pc < 90) score -= 20;
        if(retail_net > 3000) score -= 25; else if(retail_net < -3000) score += 25;
        if (tx && spot) {
            let s = tx - spot;
            if (s > 20 && s < 100) score += 5;
            if (s < -20 && s > -100) score -= 5;
        }

        const vEl = document.getElementById('verdict');
        const dEl = document.getElementById('desc');
        const tp1 = document.getElementById('tp1');
        const tp2 = document.getElementById('tp2');

        if(score >= 20) {
            vEl.innerText = "ğŸš€ éœ‡ç›ªåå¤š"; vEl.style.color = "#ef4444";
            dEl.innerText = `ç±Œç¢¼æ”¯æ’å¼·ï¼Œæ‹‰å›æ‰¾è²·é»`;
            tp1.innerText = Math.round(tx + atr); tp1.style.color="#ef4444";
            tp2.innerText = Math.round(tx + atr * 1.618); tp2.style.color="#ef4444";
        } else if(score <= -20) {
            vEl.innerText = "ğŸ“‰ éœ‡ç›ªåç©º"; vEl.style.color = "#10b981";
            dEl.innerText = `ç±Œç¢¼é¬†å‹•ï¼Œåå½ˆç©º`;
            tp1.innerText = Math.round(tx - atr); tp1.style.color="#10b981";
            tp2.innerText = Math.round(tx - atr * 1.618); tp2.style.color="#10b981";
        } else {
            vEl.innerText = "âš–ï¸ å€é–“æ´—ç›¤"; vEl.style.color = "#94a3b8";
            dEl.innerText = `å¤šç©ºäº’æŠµï¼Œå€é–“æ“ä½œ`;
            tp1.innerText = Math.round(tx + atr * 0.5); tp1.style.color="#cbd5e1";
            tp2.innerText = Math.round(tx - atr * 0.5); tp2.style.color="#cbd5e1";
        }
    }

    function recordData() {
        const tx = document.getElementById('tx').value;
        const pc = document.getElementById('pc').value;
        if(!tx || !pc) { alert("è«‹å…ˆè¼¸å…¥æ•¸æ“š"); return; }
        const today = new Date();
        const dateStr = (today.getMonth()+1) + "/" + today.getDate();
        const newData = { date: dateStr, tx: parseFloat(tx), pc: parseFloat(pc) };
        let history = JSON.parse(localStorage.getItem('stock_history') || "[]");
        const existIdx = history.findIndex(d => d.date === dateStr);
        if(existIdx >= 0) history[existIdx] = newData;
        else history.push(newData);
        if(history.length > 20) history = history.slice(-20);
        localStorage.setItem('stock_history', JSON.stringify(history));
        updateChartFromStorage();
    }

    function updateChartFromStorage() {
        const history = JSON.parse(localStorage.getItem('stock_history') || "[]");
        myChart.data.labels = history.map(d => d.date);
        myChart.data.datasets[0].data = history.map(d => d.tx);
        myChart.data.datasets[1].data = history.map(d => d.pc);
        myChart.update();
    }

    function clearHistory() {
        if(confirm("æ¸…é™¤ç´€éŒ„ï¼Ÿ")) { localStorage.removeItem('stock_history'); updateChartFromStorage(); }
    }
</script>

</body>
</html>
